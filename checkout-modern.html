<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ - BARAYA PERFUME</title>
    <link rel="stylesheet" href="styles-modern.css">

    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script>
        (function(){
            emailjs.init("EUHurGnUrY9Q-SbaO");
        })();
    </script>
</head>
<body>

    <header>
        <h1>ЁЯЫТ р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ</h1>
        <p>р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Юр╕╖р╣Ир╕нр╕гр╕▒р╕Ър╕кр╕┤р╕Щр╕Др╣Йр╕▓ р╕Юр╕гр╣Йр╕нр╕бр╕гр╕▒р╕Ър╕нр╕╡р╣Ар╕бр╕ер╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤</p>
    </header>

    <section class="checkout-form">
        <h2 style="text-align: center; color: #d4af37; margin-bottom: 30px;">
            ЁЯУЛ р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕▒р╕Фр╕кр╣Ир╕З
        </h2>

        <label for="customer-name">ЁЯСд р╕Кр╕╖р╣Ир╕н - р╕Щр╕▓р╕бр╕кр╕Бр╕╕р╕е:</label>
        <input type="text" id="customer-name" placeholder="р╕Кр╕╖р╣Ир╕н-р╕Щр╕▓р╕бр╕кр╕Бр╕╕р╕е" required>

        <label for="customer-email">ЁЯУз р╕нр╕╡р╣Ар╕бр╕е (р╕кр╕│р╕Др╕▒р╕Н!):</label>
        <input type="email" id="customer-email" placeholder="your-email@gmail.com" required>
        <small style="color: #666; display: block; margin-top: -10px; margin-bottom: 15px;">
            *р╣Ар╕гр╕▓р╕Ир╕░р╕кр╣Ир╕Зр╕нр╕╡р╣Ар╕бр╕ер╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕нр╣Др╕Ыр╕Чр╕╡р╣Ир╕нр╕╡р╣Ар╕бр╕ер╕Щр╕╡р╣Й
        </small>

        <label for="customer-address">ЁЯПа р╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣Ир╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕▒р╕Фр╕кр╣Ир╕З:</label>
        <textarea id="customer-address" placeholder="р╕Бр╕гр╕нр╕Бр╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣Ир╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕▒р╕Фр╕кр╣Ир╕Зр╣Бр╕Ър╕Ър╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф" rows="4" required></textarea>

        <label for="customer-phone">ЁЯУЮ р╣Ар╕Ър╕нр╕гр╣Мр╣Вр╕Чр╕гр╕ир╕▒р╕Юр╕Чр╣М:</label>
        <input type="tel" id="customer-phone" placeholder="0812345678" required>

        <hr style="margin: 40px 0; border: none; border-top: 2px dashed #e0e0e0;">

        <h2 style="text-align: center; color: #d4af37; margin-bottom: 20px;">
            ЁЯУД р╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щр╕Ьр╣Ир╕▓р╕Щ QR Code
        </h2>

        <div style="text-align: center; background: #f9f9f9; padding: 25px; border-radius: 15px; margin-bottom: 25px;">
            <img id="qr-code" class="qr-code" alt="QR Code р╕Юр╕гр╣Йр╕нр╕бр╣Ар╕Юр╕вр╣М" style="border: 5px solid white; box-shadow: 0 5px 20px rgba(0,0,0,0.1);">
            <p style="margin-top: 20px; color: #666; font-size: 16px;">
                ЁЯУМ р╕Бр╕гр╕╕р╕Ур╕▓р╕кр╣Бр╕Бр╕Щ QR Code р╕Фр╣Йр╕▓р╕Щр╕Ър╕Щр╣Ар╕Юр╕╖р╣Ир╕нр╕Кр╕│р╕гр╕░р╣Ар╕Зр╕┤р╕Щ
            </p>
            <p id="total-display" style="font-size: 24px; color: #d4af37; font-weight: bold; margin: 15px 0;">
                ЁЯТ░ р╕вр╕нр╕Фр╕Кр╕│р╕гр╕░: <span id="display-price">0</span> р╕Ър╕▓р╕Ч
            </p>
            <button id="downloadQR" onclick="downloadQRCode()" style="background: linear-gradient(135deg, #4facfe, #00f2fe); padding: 12px 30px; border-radius: 25px; border: none; color: white; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 10px; box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);">
                ЁЯУе р╕Фр╕▓р╕зр╕Щр╣Мр╣Вр╕лр╕ер╕Ф QR Code
            </button>
        </div>

        <h3 style="color: #d4af37; margin-top: 30px;">ЁЯУ╕ р╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Фр╕кр╕ер╕┤р╕Ыр╕Бр╕▓р╕гр╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щ</h3>
        <p style="color: #666; margin-bottom: 15px;">
            ЁЯТб р╕Бр╕гр╕╕р╕Ур╕▓р╕Цр╣Ир╕▓р╕вр╕гр╕╣р╕Ыр╕лр╕гр╕╖р╕н Screenshot р╕кр╕ер╕┤р╕Ыр╕Бр╕▓р╕гр╣Вр╕нр╕Щр╣Ар╕Зр╕┤р╕Щ
        </p>
        <input type="file" id="slipUpload" accept="image/*" onchange="previewSlip()" style="margin-bottom: 15px;">

        <div id="slipPreviewContainer" class="hidden" style="margin-top: 20px; text-align: center;">
            <h4 style="color: #06c755; margin-bottom: 10px;">тЬЕ р╕кр╕ер╕┤р╕Ыр╕Вр╕нр╕Зр╕Др╕╕р╕У:</h4>
            <img id="slipPreview" style="max-width: 100%; max-height: 400px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
        </div>

        <button id="confirmOrderBtn" style="font-size: 20px; padding: 18px;">
            тЬЕ р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Др╕│р╕кр╕▒р╣Ир╕Зр╕Лр╕╖р╣Йр╕н
        </button>

        <hr style="margin: 40px 0;">

        <h3 style="color: #d4af37; text-align: center; margin-bottom: 20px;">ЁЯУж р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕┤р╕Щр╕Др╣Йр╕▓р╕Вр╕нр╕Зр╕Др╕╕р╕У</h3>
        <div id="order-summary" style="background: #f9f9f9; padding: 20px; border-radius: 12px;">
            <ul id="order-items" style="list-style: none; text-align: left;"></ul>
        </div>
    </section>

    <script src="modern-features.js"></script>
    <script src="auth.js"></script>

    <script>
        // ... (р╣Вр╕Др╣Йр╕Ф emailjs.init р╣Ар╕Фр╕┤р╕б) ...

        function sendOrderToEmail(name, email, address, phone, orderDetails, totalPrice, slipFile) {
            return new Promise((resolve, reject) => {
                // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╣Др╕Яр╕ер╣Мр╕кр╕ер╕┤р╕Ыр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
                if (!slipFile) {
                    reject(new Error("Slip file is missing."));
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    emailjs.send("service_sfp9xjq", "template_order", {
                        customer_name: name,
                        customer_email: email,
                        customer_address: address,
                        customer_phone: phone,
                        order_list: orderDetails, // р╣Гр╕Кр╣Йр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕кр╕гр╕╕р╕Ыр╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╕Ир╕▓р╕Б checkout.js
                        order_total: totalPrice, // р╣Гр╕Кр╣Йр╕вр╕нр╕Фр╕гр╕зр╕бр╕Чр╕╡р╣Ир╕Др╕│р╕Щр╕зр╕Ур╕Ир╕▓р╕Б checkout.js
                        slip_image: e.target.result // Base64 image
                    })
                    .then(() => resolve("тЬЕ success"))
                    .catch(err => reject(err));
                };
                reader.readAsDataURL(slipFile);
            });
        }
    </script>

    <script src="checkout.js"></script>
</body>
</html>
